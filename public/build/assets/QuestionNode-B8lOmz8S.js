import{b as p,r as j,j as s}from"./app-DNy52who.js";import{a as U,H as S,P as h}from"./index-CgwXn36O.js";import C from"./ChoiceSourceHandle-Da1hy_DY.js";import{F as x,a as R}from"./index-sdPLVhIB.js";var o=[];for(var m=0;m<256;++m)o.push((m+256).toString(16).slice(1));function _(t,e=0){return(o[t[e+0]]+o[t[e+1]]+o[t[e+2]]+o[t[e+3]]+"-"+o[t[e+4]]+o[t[e+5]]+"-"+o[t[e+6]]+o[t[e+7]]+"-"+o[t[e+8]]+o[t[e+9]]+"-"+o[t[e+10]]+o[t[e+11]]+o[t[e+12]]+o[t[e+13]]+o[t[e+14]]+o[t[e+15]]).toLowerCase()}var u,q=new Uint8Array(16);function E(){if(!u&&(u=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!u))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(q)}var O=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const b={randomUUID:O};function Q(t,e,d){if(b.randomUUID&&!e&&!t)return b.randomUUID();t=t||{};var r=t.random||(t.rng||E)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,_(r)}const V=async(t,e,d)=>{const r=e.filter(i=>i.type==="questionNode"),c=e.filter(i=>i.type==="resultNode");try{const i=await p.post("/commit",{flow_id:t,update_questions:JSON.stringify(r),update_results:JSON.stringify(c),update_edges:JSON.stringify(d)})}catch(i){console.log(i)}},k=async t=>{const e=p.get("/question-nodes",{params:{flow_id:t}}),d=p.get("/result-nodes",{params:{flow_id:t}}),[r,c]=await Promise.all([e,d]),i=r.data.length?JSON.parse(r.data):[],g=c.data.length?JSON.parse(c.data):[];return[...i,...g]},L=async t=>{const e=await p.get("/edges",{params:{flow_id:t}});return e.data.length?JSON.parse(e.data):[]},F=()=>Q(),J=({id:t,data:e,positionAbsoluteX:d,positionAbsoluteY:r})=>{const{setEdges:c,updateNodeData:i,deleteElements:g}=U(),y=n=>{i(t,{...e,topic:n.currentTarget.value})},N=()=>{const n=F();i(t,{...e,choices:[...e.choices,{id:n,content:""}]})},w=(n,a)=>{e.choices.length>6||i(t,{...e,choices:e.choices.map(l=>l.id===a.id?{...l,content:n.currentTarget.value}:l)})},v=n=>{e.choices.length<=1||(i(t,{...e,choices:e.choices.filter(a=>a.id!=n.id)}),c(a=>a.filter(l=>l.sourceHandle!=n.id)))},f=()=>{g({nodes:[{id:t}]})};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"rounded-t-md min-w-64 px-2",children:[s.jsx(S,{id:t,position:h.Left,type:"target",style:{cursor:"pointer"}}),s.jsxs("div",{className:"flex flex-col custom-drag-handle",children:[s.jsx("button",{className:"text-white hover:text-red-300 font-bold mb-1 rounded w-fit self-end text-sm",type:"button",onClick:f,children:s.jsx(x,{})}),s.jsx("input",{className:"placeholder-gray-400 rounded-t-md p-1 text-center bg-slate-500 text-white w-full border-none focus:ring-0",value:e.topic,placeholder:"質問を入力してください",onChange:n=>y(n)})]}),s.jsxs("div",{className:"bg-slate-800",children:[e.choices.map((n,a)=>s.jsxs("div",{className:"flex justify-between p-1 text-white bg-slate-800",children:[s.jsx("input",{className:"placeholder-gray-600 border-blue-100 focus:border-blue-400 focus:ring-0 bg-transparent text-white w-full",value:n.content,placeholder:"選択肢を入力してください",onChange:l=>w(l,n)}),s.jsx("button",{className:"rounded-md bg-slate-800 p-1 border border-transparent text-center text-white transition-all shadow-sm hover:shadow-lg focus:bg-slate-700 focus:shadow-none active:bg-slate-700 hover:bg-slate-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none",type:"button",onClick:()=>v(n),children:s.jsx(x,{className:"text-[10px]"})}),s.jsx(C,{id:n.id,type:"source",position:h.Right,connectionLimit:1,style:{top:75+51*a}})]},n.id)),s.jsx("div",{className:"p-1",children:e.choices.length<6&&s.jsxs("button",{className:"text-gray-600 border border-gray-600 hover:text-gray-300 hover:border-gray-300 font-bold mt-1 w-full text-[10px] py-1 flex justify-center items-center gap-1",onClick:N,children:[s.jsx(R,{}),s.jsx("p",{children:"選択肢追加"})]})})]})]})})},T=j.memo(J),z=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{T as Q,L as a,F as b,V as c,z as d,k as g};
