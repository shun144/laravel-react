import{r as o,y as A,j as a}from"./app-BpPJ0wDp.js";import{g as c}from"./utils-CBLfBWaP.js";import{u}from"./store-BmW2zk-D.js";import V from"./CityHeavenQuestionNode-Cz8YSkua.js";import q from"./CityHeavenResultNode-DKOlqzW7.js";import{D as L}from"./core.esm-n1KgIOVm.js";import f from"./Draggable-CVMNA2eX.js";import P from"./Droppable-BSNyyJwR.js";import{u as z,b as B,c as U,r as X,d as Y,i as G,C as W,S as _,e as $,f as J,h as K}from"./index-xtGAtnNo.js";/* empty css             *//* empty css                           */import"./react-mw6vdnkP.js";import"./ChoiceSourceHandle-DrWVe8Kl.js";import"./index-COlYgOy-.js";import"./iconBase-Bz5oqgYx.js";import"./index-CPEEJ0s8.js";import"./SalesPointSelect-D99mSnl0.js";import"./QuestionSubMenu-BkuPe9rV.js";import"./index-DXD5quO5.js";import"./ResultSubMenu-c9uAl34U.js";const Z=({initialNodes:y,initialEdges:C})=>{const[b,p]=o.useState(y),[x,s]=o.useState(C),i=o.useRef(!0),l=u(e=>e.isDirty),d=u(e=>e.setIsDirty),h=u(e=>e.setFirstNodeId),{screenToFlowPosition:N,addNodes:g,setViewport:ee,getNodes:E}=z(),k=o.useMemo(()=>({cityHeavenQuestionNode:V,cityHeavenResultNode:q}),[]);o.useEffect(()=>{const e=A.on("before",t=>(console.log(l),l?confirm("変更が保存されていませんがページを離れてもよろしいですか？"):!0));return()=>{e()}},[l]);const w=o.useCallback(e=>{p(t=>B(e,t)),d(!0)},[p,d]),D=o.useCallback(e=>{s(t=>U(e,t)),d(!0)},[s,d]),R=e=>{const t=c(),n=c();E().length===0&&h(t),g({id:t,data:{topic:"",choices:[{id:n,content:"",salePoints:[]}]},position:e,type:"cityHeavenQuestionNode",dragHandle:".custom-drag-handle"})},j=e=>{const t=c();g({id:t,data:{result:""},position:e,type:"cityHeavenResultNode",dragHandle:".custom-drag-handle"})},S=o.useCallback(({active:e,over:t,delta:n,activatorEvent:r})=>{if(!(t==null||t.id!="droppableArea")&&r instanceof MouseEvent){const Q=r.pageX+n.x,T=r.pageY+n.y,m=N({x:Q,y:T});e.id==="draggable-question"&&R(m),e.id==="draggable-result"&&j(m)}},[]),v=o.useCallback((e,t)=>{i.current=!0,s(n=>X(e,t,n))},[]),H=o.useCallback(()=>{i.current=!1},[]),I=o.useCallback(e=>{i.current||s(t=>t.filter(n=>n.id!==e.id)),i.current=!0},[]),F=o.useCallback(e=>{s(t=>Y({...e,type:"smoothstep"},t))},[s]),M=o.useCallback((e,t)=>{s(n=>n.map(r=>r.id===t.id?{...r,animated:!0,style:{stroke:"gold",strokeWidth:3,zIndex:1e3}}:{...r,animated:!1,style:{zIndex:0}}))},[s]),O=o.useCallback((e,t)=>{e.preventDefault(),s(n=>n.filter(r=>r.id!==t.id))},[s]);return a.jsx("div",{className:"grow w-full flex",children:a.jsxs(L,{onDragEnd:e=>S(e),children:[a.jsxs("div",{className:"h-full w-[10%] flex items-center flex-col gap-y-3 py-3 bg-slate-800",children:[a.jsx(f,{id:"draggable-question",label:"質問"}),a.jsx(f,{id:"draggable-result",label:"アンケート終了"})]}),a.jsx(P,{id:"droppableArea",children:a.jsxs(G,{nodes:b,edges:x,nodeTypes:k,onNodesChange:w,onEdgesChange:D,fitView:!0,fitViewOptions:{padding:.4},snapToGrid:!0,connectionLineType:W.SmoothStep,onReconnect:v,onReconnectStart:H,onReconnectEnd:(e,t)=>I(t),onConnect:F,onEdgeClick:M,onEdgeContextMenu:O,elevateEdgesOnSelect:!0,panOnScroll:!0,selectionOnDrag:!0,panOnDrag:[1,2],selectionMode:_.Partial,children:[a.jsx($,{color:"#222",variant:J.Lines,gap:20}),a.jsx(K,{})]})})]})})},Ne=o.memo(Z);export{Ne as default};
