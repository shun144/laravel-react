import{r as o,j as s}from"./app-Fxrr18RL.js";import{c as M,g as l}from"./utils-DtvS6Fzu.js";import{u as c}from"./store-B-sIPZ31.js";import U from"./CityHeavenQuestionNode-B5wSY8sZ.js";import _ from"./CityHeavenResultNode-B0i2Bybf.js";import{D as X}from"./core.esm-PeMqG9ak.js";import b from"./Draggable-Bsuyemzm.js";import Y from"./Droppable-B0ef5LCv.js";import{u as G,a as P,b as $,r as z,c as J,i as K,S as W,C as Z,B as ee,d as te,e as oe}from"./index-BdOFtew_.js";import{_ as x}from"./index-Dk9bAGlJ.js";import"./ReactContexify.min-bouRtaFS.js";import"./react-3fYLzgl2.js";import"./ChoiceSourceHandle-ClxD4gBg.js";import"./index-BFep6aaj.js";import"./iconBase-DN5vp9AL.js";import"./SalesPointSelect-CdQRQ3wS.js";import"./FlowMenu-BUgNQdWB.js";const se=({flowId:h,initialNodes:y,initialEdges:C})=>{const[w,ne,N]=G(y),[R,a,j]=P(C),[d,E]=o.useState(),S=c(e=>e.setFirstNodeId),u=c(e=>e.firstNodeId),p=c(e=>e.flowTitle),m=c(e=>e.flowUrl),r=o.useRef(!0),{screenToFlowPosition:H,addNodes:g,setViewport:ae,getNodes:k,deleteElements:re}=$(),I=o.useMemo(()=>({cityHeavenQuestionNode:U,cityHeavenResultNode:_}),[]),T=o.useMemo(()=>({type:"smoothstep"}),[]),v=e=>{const t=l(),n=l();k().length===0&&S(t),g({id:t,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"cityHeavenQuestionNode",dragHandle:".custom-drag-handle"})},F=e=>{const t=l();g({id:t,data:{result:""},position:e,type:"cityHeavenResultNode",dragHandle:".custom-drag-handle"})},D=o.useCallback(({active:e,over:t,delta:n,activatorEvent:i})=>{if(!(t==null||t.id!="droppableA")&&i instanceof MouseEvent){const B=i.pageX+n.x,L=i.pageY+n.y,f=H({x:B,y:L});e.id==="draggable-question"&&v(f),e.id==="draggable-result"&&F(f)}},[]),Q=o.useCallback(()=>{if(d){const e=d.toObject();(async()=>{try{const t=await M(h,e.nodes,e.edges,u,p,m);x.success("Successfully toasted!",{duration:3e3})}catch{x.error("失敗!")}})()}},[d,u,p,m]),A=o.useCallback((e,t)=>{r.current=!0,a(n=>z(e,t,n))},[]),O=o.useCallback(()=>{r.current=!1},[]),V=o.useCallback(e=>{r.current||a(t=>t.filter(n=>n.id!==e.id)),r.current=!0},[]),q=o.useCallback(e=>{a(t=>J(e,t))},[a]);return s.jsx("div",{className:"h-full flex",children:s.jsxs(X,{onDragEnd:e=>D(e),children:[s.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 py-3 bg-slate-800",children:[s.jsx(b,{id:"draggable-question",label:"質問"}),s.jsx(b,{id:"draggable-result",label:"アンケート終了"}),s.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:()=>Q(),children:"保存"})]}),s.jsx(Y,{id:"droppableA",children:s.jsxs(K,{nodes:w,edges:R,nodeTypes:I,onNodesChange:N,onEdgesChange:j,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,edgeTypes:{smoothstep:W},connectionLineType:Z.SmoothStep,onReconnect:(e,t)=>A(e,t),onReconnectStart:()=>O(),onReconnectEnd:(e,t)=>V(t),onConnect:e=>q(e),onInit:E,defaultEdgeOptions:T,children:[s.jsx(ee,{color:"#222",variant:te.Lines,gap:20}),s.jsx(oe,{})]})})]})})},je=o.memo(se);export{je as default};
