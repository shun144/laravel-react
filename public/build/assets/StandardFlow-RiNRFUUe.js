import{r as o,j as s}from"./app-D37GFJK7.js";import{a as Q,b as B,g as c}from"./utils-DPyr1Ivf.js";import{u as i}from"./store-BgV8G_Jj.js";import H from"./QuestionNode-BcGRdBlB.js";import M from"./ResultNode-Cp2ROIc5.js";import{D as U}from"./core.esm-C-cttlut.js";import m from"./Draggable-bP3XBXZI.js";import X from"./Droppable-C80YQhjw.js";import{j as Y,k as G,u as L,d as P,r as _,i as $,l as z,e as J,f as K,h as W}from"./index-DtiTTmZW.js";/* empty css             */import{I as Z}from"./index-D8RmsUuP.js";import"./react-BV781huI.js";import"./ChoiceSourceHandle-CmG089Jl.js";import"./index-7Yk29fhJ.js";import"./iconBase-BFWDsY2u.js";const v=({flowId:u})=>{const[f,b,x]=Y([]),[h,a,N]=G([]),{screenToFlowPosition:w,addNodes:p,setViewport:ee}=L(),[l,j]=o.useState();i(e=>e.setFirstNodeId);const C=i(e=>e.firstNodeId),E=i(e=>e.flowTitle),I=i(e=>e.flowUrl),k=o.useMemo(()=>({questionNode:H,resultNode:M}),[]);o.useEffect(()=>{(async()=>{const e=await Q(u),t=await B(u);b(e),a(t)})()},[]);const R=o.useCallback(e=>a(t=>P(e,t)),[a]),S=e=>{const t=c(),n=c();p({id:t,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionNode",dragHandle:".custom-drag-handle"})},y=e=>{const t=c();p({id:t,data:{result:""},position:e,type:"resultNode",dragHandle:".custom-drag-handle"})},D=o.useCallback(({active:e,over:t,delta:n,activatorEvent:r})=>{if(!(t==null||t.id!="droppableA")&&r instanceof MouseEvent){const O=r.pageX+n.x,V=r.pageY+n.y,g=w({x:O,y:V});e.id==="draggable-question"&&S(g),e.id==="draggable-result"&&y(g)}},[]),T=o.useCallback(()=>{l&&l.toObject()},[l,C,E,I]),d=o.useRef(!0),F=o.useCallback((e,t)=>{d.current=!0,a(n=>_(e,t,n))},[]),q=o.useCallback(()=>{d.current=!1},[]),A=o.useCallback((e,t)=>{d.current||a(n=>n.filter(r=>r.id!==t.id)),d.current=!0},[]);return s.jsxs("div",{className:"flex h-full",children:[s.jsxs(U,{onDragEnd:D,children:[s.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[s.jsx(m,{id:"draggable-question",label:"質問追加"}),s.jsx(m,{id:"draggable-result",label:"結果追加"}),s.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:T,children:"保存"})]}),s.jsx(X,{id:"droppableA",children:s.jsxs($,{nodes:f,edges:h,nodeTypes:k,edgeTypes:{smoothstep:z},onEdgesChange:N,onNodesChange:x,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:F,onReconnectStart:q,onReconnectEnd:A,onConnect:R,onInit:j,children:[s.jsx(J,{color:"#222",variant:K.Lines,gap:20}),s.jsx(W,{})]})})]}),s.jsx(Z,{position:"bottom-right",reverseOrder:!1})]})},be=o.memo(v);export{be as default};
