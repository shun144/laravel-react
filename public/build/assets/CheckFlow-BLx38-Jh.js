import{r as o,j as t}from"./app-Djr3pS6i.js";import{b as V,c as B,d as O,e as P,f as l}from"./utils-D-QC8cQz.js";import{u as H,Q as M}from"./QuestionCheckNode-Bq_Cg6u2.js";import X from"./RecommendNode-D2mxrfDI.js";import{D as Y}from"./core.esm-BfgOf-z1.js";import{Draggable as h}from"./Draggable-BYtgIxNz.js";import{Droppable as G}from"./Droppable-BSDkjo0I.js";import{u as L,a as U,b as _,c as $,r as v,i as z,S as J,P as K,B as W,d as Z,C as ee}from"./index-FTrqLg0J.js";/* empty css             */import"./ChoiceSourceHandle-CeZD5PdG.js";import"./index-DTFTZLlI.js";import"./iconBase-DKpWyc9o.js";import"./react-5W0nFZLx.js";import"./DraggableBlockSource-BgPDNHMd.js";const se=({flowId:d})=>{const[f,x,b]=L([]),[N,a,C]=U([]),{screenToFlowPosition:w,addNodes:u,setViewport:te,getNodes:j}=_(),[c,k]=o.useState(),{firstNodeId:g,setFirstNodeId:m}=H(),E=o.useMemo(()=>({questionCheckNode:M,recommendNode:X}),[]);o.useEffect(()=>{(async()=>{const e=await V(d),s=await B(d),n=await O(d);x(e),a(s),m(n)})()},[]);const R=o.useCallback(e=>a(s=>$(e,s)),[a]),S=e=>{const s=l(),n=l();j().length===0&&m(s),u({id:s,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionCheckNode",dragHandle:".custom-drag-handle"})},y=e=>{const s=l();u({id:s,data:{result:""},position:e,type:"recommendNode",dragHandle:".custom-drag-handle"})},F=o.useCallback(({active:e,over:s,delta:n,activatorEvent:i})=>{if(!(s==null||s.id!="droppableA")&&i instanceof MouseEvent){const A=i.pageX+n.x,T=i.pageY+n.y,p=w({x:A,y:T});e.id==="draggable-question"&&S(p),e.id==="draggable-result"&&y(p)}},[]),I=o.useCallback(()=>{if(c){const e=c.toObject();P(d,e.nodes,e.edges,g)}},[c,g]),r=o.useRef(!0),D=o.useCallback((e,s)=>{r.current=!0,a(n=>v(e,s,n))},[]),Q=o.useCallback(()=>{r.current=!1},[]),q=o.useCallback((e,s)=>{r.current||a(n=>n.filter(i=>i.id!==s.id)),r.current=!0},[]);return t.jsx("div",{className:"flex h-full",children:t.jsxs(Y,{onDragEnd:F,children:[t.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[t.jsx(h,{id:"draggable-question",label:"質問(チェック付き)追加"}),t.jsx(h,{id:"draggable-result",label:"推奨追加"}),t.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:I,children:"保存"}),t.jsx("div",{className:"text-blue-200",children:"チェックフローです"})]}),t.jsx(G,{id:"droppableA",children:t.jsxs(z,{nodes:f,edges:N,nodeTypes:E,edgeTypes:{smoothstep:J},onEdgesChange:C,onNodesChange:b,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:D,onReconnectStart:Q,onReconnectEnd:q,onConnect:R,onInit:k,children:[t.jsx(K,{position:"top-right",children:t.jsx("div",{className:"w-10 h-10 bg-slate-50",children:"test"})}),t.jsx(W,{color:"#222",variant:Z.Lines,gap:20}),t.jsx(ee,{})]})})]})})},xe=o.memo(se);export{xe as default};
