import{r as s,q as U,j as e,y as J}from"./app-BMXDJVyd.js";import{u as n}from"./store-C-TAy8r_.js";import{u as M}from"./index-DYGodSJL.js";import{n as g}from"./index-BqrmyCi8.js";import{M as z}from"./index-BwFwFSRL.js";import{M as H}from"./react-tooltip.min-B3v_n3RK.js";import"./react-tooltip.min-DZcZWJaY.js";import"./react-BQFNYpn0.js";import"./iconBase-DyeLHBi8.js";import"./floating-ui.dom-D0k0YRlw.js";const V=({id:c,initialTitle:w,initialUrl:b})=>{const{props:j}=U(),d=j.auth.user.english_name,[u,y]=s.useState(w),[x,N]=s.useState(b),[r,m]=s.useState({}),{getNodes:v,getEdges:S,getViewport:C}=M(),k=n(t=>t.firstNodeId),a=n(t=>t.setIsDirty),T=n(t=>t.isDirty),f=s.useRef(null),[p,h]=s.useState(!1),D=t=>{t.preventDefault();const o=v(),i=S(),$=o.filter(l=>l.type==="qNode"),q=o.filter(l=>l.type==="rNode"),{x:E,y:F,zoom:I}=C();J.post(`/flow/${c}`,{update_questions:JSON.stringify($),update_results:JSON.stringify(q),update_edges:JSON.stringify(i),first_question_id:k,title:u,url:x,x:E,y:F,zoom:I},{onSuccess:()=>{m({}),g.success("保存しました",{duration:4e3}),a(!1)},onError:l=>{m(l);for(const L of Object.values(l))g.error(L,{duration:5e3})}})},O=s.useCallback(t=>{y(t.currentTarget.value),a(!0)},[]),R=t=>{N(t.currentTarget.value),a(!0)},_=async t=>{var o;try{t.preventDefault(),await navigator.clipboard.writeText(`${window.location.origin}/${d}/${(o=f.current)==null?void 0:o.value}`),h(!0),setTimeout(()=>h(!1),2e3)}catch(i){console.error("コピーに失敗しました:",i)}};return e.jsx("div",{className:"h-14 w-full bg-white",children:e.jsx("div",{className:"h-full w-full flex items-center bg-slate-100",children:e.jsxs("form",{onSubmit:D,className:"w-full h-14 flex justify-around items-center",children:[e.jsxs("div",{className:"h-full w-2/12 flex justify-between items-center",children:[e.jsx("div",{className:"text-gray-500/70 font-bold text-lg pl-4",children:`ID:${c}`}),e.jsx("div",{className:"h-10 w-16 ",children:e.jsxs("button",{className:"relative w-full h-full bg-indigo-500 px-2 text-white rounded-md shadow-xl transition-all hover:bg-indigo-600 select-none hover:shadow-xl duration-200",children:["保 存",T&&e.jsxs("span",{className:"absolute flex h-3 w-3 -top-1 -right-1",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-rose-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-rose-500 opacity-85"})]})]})})]}),e.jsxs("div",{className:"flex justify-start items-center pl-20 gap-x-10 w-10/12",children:[e.jsxs("div",{className:" flex flex-col items-center w-96",children:[e.jsx("div",{children:r.title&&e.jsx("div",{className:"text-sm text-red-500",children:r.title})}),e.jsxs("div",{className:"flex w-full flex-row items-center",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-800 h-10 leading-10  text-center",children:"タイトル："}),e.jsx("input",{type:"text",id:"title",placeholder:"タイトルを入力してください",maxLength:50,className:"grow bg-white border border-slate-400 text-gray-900 text-sm focus:ring-transparent focus:border-blue-400 block  p-2.5 h-full placeholder-slate-400 rounded",onChange:O,value:u})]})]}),e.jsxs("div",{className:" flex flex-col items-center w-96",children:[e.jsx("div",{children:r.url&&e.jsx("div",{className:"text-sm text-red-500",children:r.url})}),e.jsxs("div",{className:"flex w-full flex-row items-center",children:[e.jsx("label",{htmlFor:"url",className:"block text-sm font-medium text-gray-800 h-10 leading-10  text-center",children:"URL："}),e.jsxs("div",{className:"text-gray-400 border-slate-300 pr-1",children:[window.location.origin,"/",d,"/"]}),e.jsx("input",{type:"text",id:"url",placeholder:"URLを入力してください",maxLength:15,ref:f,className:`grow bg-white  text-gray-900 text-sm focus:ring-transparent  block  p-2.5 h-full placeholder-slate-400 rounded ${r.url?"border-rose-300 focus:border-rose-400 border-2":"border-slate-400 focus:border-blue-400 border"} `,onChange:R,value:x}),e.jsx("button",{"data-tooltip-id":"my-tooltip","data-tooltip-content":"URLをコピーしました",onClick:_,className:"pl-2 py-2 text-indigo-400 rounded transition-all hover:text-indigo-800 duration-300",children:e.jsx(z,{})}),p&&e.jsx(H,{id:"my-tooltip",place:"top",style:{background:"#6366f1",fontSize:"12px",padding:"4px 8px"},openOnClick:!0,isOpen:p})]})]})]})]})})})},ee=s.memo(V);export{ee as default};
