import{r as n,q as B,y as H,j as a}from"./app-BSo6kXZY.js";import{b as l}from"./utils-Cv_Fd-UN.js";import{u as c}from"./store-Cp7ap0tw.js";import P from"./StandardQuestionNode-DaZ9P6dz.js";import U from"./StandardResultNode-D9helA5Q.js";import{D as V}from"./core.esm-B1soZA4t.js";import f from"./Draggable-DQnjGjdO.js";import W from"./Droppable-BK58cr0Z.js";import{u as X,h as Y,j as G,r as _,d as $,i as z,k as J,l as K,e as Z,f as ee,C as te}from"./index-w2Xxs-C-.js";/* empty css             *//* empty css                           */import"./react-Bzdh-nCb.js";import"./ChoiceSourceHandle-BxEXwUOL.js";import"./index-BlMAzcRb.js";import"./iconBase-11qJnLgw.js";import"./index--JVHH4dj.js";import"./QuestionSubMenu-Ms5qorF1.js";import"./index-BJXdejGN.js";import"./ResultSubMenu-BH9LGq-u.js";const oe=({initialNodes:b,initialEdges:C,defaultViewport:h})=>{const[x,u]=n.useState(b),[y,r]=n.useState(C),d=n.useRef(!0),p=c(e=>e.isDirty),i=c(e=>e.setIsDirty),k=c(e=>e.setFirstNodeId),{screenToFlowPosition:N,addNodes:m,setViewport:ne,getNodes:E}=X(),{url:S}=B(),w=n.useMemo(()=>({qNode:P,rNode:U}),[]);n.useEffect(()=>{const e=H.on("before",t=>{const o=t.detail.visit;return o.url.pathname===S&&o.method==="post"?!0:p?confirm("変更が保存されていませんがページを離れてもよろしいですか？"):!0});return()=>{e()}},[p]);const j=n.useCallback(e=>{u(t=>Y(e,t)),i(!0)},[u,i]),D=n.useCallback(e=>{r(t=>G(e,t)),i(!0)},[r,i]),R=e=>{const t=l(),o=l();E().length===0&&k(t),m({id:t,data:{topic:"",choices:[{id:o,content:""}]},position:e,type:"qNode",dragHandle:".dhandle"})},F=e=>{const t=l();m({id:t,data:{result:""},position:e,type:"rNode",dragHandle:".dhandle"})},I=n.useCallback(({active:e,over:t,delta:o,activatorEvent:s})=>{if(!(t==null||t.id!="droppableArea")&&s instanceof MouseEvent){const O=s.pageX+o.x,Q=s.pageY+o.y,g=N({x:O,y:Q});e.id==="draggable-question"&&R(g),e.id==="draggable-result"&&F(g)}},[]),M=n.useCallback((e,t)=>{d.current=!0,r(o=>_(e,t,o))},[]),q=n.useCallback(()=>{d.current=!1},[]),T=n.useCallback(e=>{d.current||r(t=>t.filter(o=>o.id!==e.id)),d.current=!0},[]),A=n.useCallback(e=>{r(t=>$({...e,type:"smoothstep"},t))},[r]),v=n.useCallback((e,t)=>{r(o=>o.map(s=>s.id===t.id?{...s,animated:!s.animated,style:s.animated?{stroke:"gray",strokeWidth:2}:{stroke:"gold",strokeWidth:3}}:{...s,animated:!1,style:{}}))},[r]),L=n.useCallback((e,t)=>{e.preventDefault(),r(o=>o.filter(s=>s.id!==t.id))},[r]);return a.jsx("div",{className:"grow w-full flex",children:a.jsxs(V,{onDragEnd:I,children:[a.jsxs("div",{className:"h-full w-[5%] flex items-center flex-col gap-y-6 pt-12 bg-slate-800",children:[a.jsx(f,{id:"draggable-question",label:"質問",btnColor:"indigo"}),a.jsx(f,{id:"draggable-result",label:"結果",btnColor:"orange"})]}),a.jsx(W,{id:"droppableArea",children:a.jsxs(z,{nodes:x,edges:y,nodeTypes:w,onNodesChange:j,onEdgesChange:D,snapToGrid:!0,connectionLineType:J.SmoothStep,onReconnect:M,onReconnectStart:q,onReconnectEnd:(e,t)=>T(t),onConnect:A,onEdgeClick:v,onEdgeContextMenu:L,elevateEdgesOnSelect:!0,defaultViewport:h,panOnScroll:!0,elementsSelectable:!0,selectionMode:K.Partial,children:[a.jsx(Z,{color:"#222",variant:ee.Lines,gap:20}),a.jsx(te,{})]})})]})})},Ee=n.memo(oe);export{Ee as default};
