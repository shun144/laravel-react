import{j as t,r as o}from"./app-DNy52who.js";import{Q as A,g as Q,a as T,c as V,b as l}from"./QuestionNode-B8lOmz8S.js";import B from"./ResultNode-BTmQMaul.js";import{D as P}from"./core.esm-TI6N5I_Z.js";import{Draggable as g}from"./Draggable-Md_rZACd.js";import{Droppable as M}from"./Droppable-Cm3CpCm6.js";import{R as O,b as X,c as Y,a as G,d as L,r as U,i as _,S as $,e as v,B as z,f as H,C as J}from"./index-CgwXn36O.js";import"./ChoiceSourceHandle-Da1hy_DY.js";import"./index-sdPLVhIB.js";import"./iconBase-BvFoCglc.js";import"./DraggableBlockSource-C7DkLY2c.js";const K=({flowId:a})=>{const[m,f,x]=X([]),[b,i,h]=Y([]),{screenToFlowPosition:N,addNodes:u,setViewport:W}=G(),[c,j]=o.useState(),w=o.useMemo(()=>({questionNode:A,resultNode:B}),[]);o.useEffect(()=>{(async()=>{const e=await Q(a),s=await T(a);f(e),i(s)})()},[]);const C=o.useCallback(e=>i(s=>L(e,s)),[i]),E=e=>{const s=l(),n=l();u({id:s,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionNode"})},R=e=>{const s=l();u({id:s,data:{result:""},position:e,type:"resultNode"})},k=o.useCallback(({active:e,over:s,delta:n,activatorEvent:d})=>{if(!(s==null||s.id!="droppableA")&&d instanceof MouseEvent){const q=d.pageX+n.x,I=d.pageY+n.y,p=N({x:q,y:I});e.id==="draggable-question"&&E(p),e.id==="draggable-result"&&R(p)}},[]),y=o.useCallback(()=>{if(c){const e=c.toObject();V(a,e.nodes,e.edges)}},[c]),r=o.useRef(!0),S=o.useCallback((e,s)=>{r.current=!0,i(n=>U(e,s,n))},[]),D=o.useCallback(()=>{r.current=!1},[]),F=o.useCallback((e,s)=>{r.current||i(n=>n.filter(d=>d.id!==s.id)),r.current=!0},[]);return t.jsx("div",{className:"flex h-full",children:t.jsxs(P,{onDragEnd:k,children:[t.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[t.jsx(g,{id:"draggable-question",label:"質問追加"}),t.jsx(g,{id:"draggable-result",label:"結果追加"}),t.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:y,children:"保存"})]}),t.jsx(M,{id:"droppableA",children:t.jsxs(_,{nodes:m,edges:b,nodeTypes:w,edgeTypes:{smoothstep:$},onEdgesChange:h,onNodesChange:x,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:S,onReconnectStart:D,onReconnectEnd:F,onConnect:C,onInit:j,children:[t.jsx(v,{position:"top-right",children:t.jsx("div",{className:"w-10 h-10 bg-slate-50",children:"test"})}),t.jsx(z,{color:"#222",variant:H.Lines,gap:20}),t.jsx(J,{})]})})]})})},le=a=>t.jsx(O,{children:t.jsx(K,{flowId:a})});export{le as default};
