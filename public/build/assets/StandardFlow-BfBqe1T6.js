import{r as o,j as t}from"./app-BpPJ0wDp.js";import{a as U,b as _,e as B,g as u}from"./utils-CBLfBWaP.js";import{u as i}from"./store-BmW2zk-D.js";import H from"./QuestionNode-BAdK_Bq5.js";import M from"./ResultNode-C3CB_MAP.js";import{D as X}from"./core.esm-n1KgIOVm.js";import x from"./Draggable-CVMNA2eX.js";import Y from"./Droppable-BSNyyJwR.js";import{j as G,k as L,u as P,d as $,r as z,i as J,l as K,e as W,f as Z,h as v}from"./index-xtGAtnNo.js";/* empty css             */import{_ as h,I as ee}from"./index-x-fziZDy.js";import"./react-mw6vdnkP.js";import"./ChoiceSourceHandle-DrWVe8Kl.js";import"./index-COlYgOy-.js";import"./iconBase-Bz5oqgYx.js";const se=({flowId:c})=>{const[w,N,j]=G([]),[C,a,E]=L([]),{screenToFlowPosition:S,addNodes:p,setViewport:te}=P(),[l,y]=o.useState();i(e=>e.setFirstNodeId);const g=i(e=>e.firstNodeId),m=i(e=>e.flowTitle),f=i(e=>e.flowUrl),k=o.useMemo(()=>({questionNode:H,resultNode:M}),[]);o.useEffect(()=>{(async()=>{const e=await U(c),s=await _(c);N(e),a(s)})()},[]);const I=o.useCallback(e=>a(s=>$(e,s)),[a]),R=e=>{const s=u(),n=u();p({id:s,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionNode",dragHandle:".custom-drag-handle"})},D=e=>{const s=u();p({id:s,data:{result:""},position:e,type:"resultNode",dragHandle:".custom-drag-handle"})},F=o.useCallback(({active:e,over:s,delta:n,activatorEvent:r})=>{if(!(s==null||s.id!="droppableA")&&r instanceof MouseEvent){const V=r.pageX+n.x,Q=r.pageY+n.y,b=S({x:V,y:Q});e.id==="draggable-question"&&R(b),e.id==="draggable-result"&&D(b)}},[]),T=o.useCallback(()=>{if(l){const e=l.toObject();(async()=>{try{const s=await B(c,e.nodes,e.edges,g,m,f);h.success("Successfully toasted!",{duration:3e3})}catch{h.error("失敗!")}})()}},[l,g,m,f]),d=o.useRef(!0),q=o.useCallback((e,s)=>{d.current=!0,a(n=>z(e,s,n))},[]),A=o.useCallback(()=>{d.current=!1},[]),O=o.useCallback((e,s)=>{d.current||a(n=>n.filter(r=>r.id!==s.id)),d.current=!0},[]);return t.jsxs("div",{className:"flex h-full",children:[t.jsxs(X,{onDragEnd:F,children:[t.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[t.jsx(x,{id:"draggable-question",label:"質問追加"}),t.jsx(x,{id:"draggable-result",label:"結果追加"}),t.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:T,children:"保存"})]}),t.jsx(Y,{id:"droppableA",children:t.jsxs(J,{nodes:w,edges:C,nodeTypes:k,edgeTypes:{smoothstep:K},onEdgesChange:E,onNodesChange:j,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:q,onReconnectStart:A,onReconnectEnd:O,onConnect:I,onInit:y,children:[t.jsx(W,{color:"#222",variant:Z.Lines,gap:20}),t.jsx(v,{})]})})]}),t.jsx(ee,{position:"bottom-right",reverseOrder:!1})]})},he=o.memo(se);export{he as default};
