import{r as o,j as t}from"./app-CLtd0l1O.js";import{e as Q,f as U,h as _,g as u}from"./utils-DnMOXxyc.js";import{u as i}from"./store-Bh6xa2Wy.js";import H from"./QuestionNode-CgR43w4S.js";import M from"./ResultNode-dZyAx1cF.js";import{D as X}from"./core.esm-Chk-jPgP.js";import b from"./Draggable-Dl99XLQ4.js";import Y from"./Droppable-or9Q86UY.js";import{j as G,k as L,b as P,e as $,r as v,i as z,S as J,B as K,f as W,g as Z}from"./index-CsmzVUu1.js";import{_ as h,I as ee}from"./index-CJUi75YX.js";import"./react-CHX_hP92.js";import"./ChoiceSourceHandle-DZ3aU89a.js";import"./index-DfVLiIJs.js";import"./iconBase-B1NUaL_I.js";const se=({flowId:c})=>{const[w,N,j]=G([]),[C,a,E]=L([]),{screenToFlowPosition:S,addNodes:g,setViewport:te}=P(),[l,y]=o.useState();i(e=>e.setFirstNodeId);const p=i(e=>e.firstNodeId),m=i(e=>e.flowTitle),f=i(e=>e.flowUrl),k=o.useMemo(()=>({questionNode:H,resultNode:M}),[]);o.useEffect(()=>{(async()=>{const e=await Q(c),s=await U(c);N(e),a(s)})()},[]);const I=o.useCallback(e=>a(s=>$(e,s)),[a]),R=e=>{const s=u(),n=u();g({id:s,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionNode",dragHandle:".custom-drag-handle"})},D=e=>{const s=u();g({id:s,data:{result:""},position:e,type:"resultNode",dragHandle:".custom-drag-handle"})},F=o.useCallback(({active:e,over:s,delta:n,activatorEvent:r})=>{if(!(s==null||s.id!="droppableA")&&r instanceof MouseEvent){const V=r.pageX+n.x,B=r.pageY+n.y,x=S({x:V,y:B});e.id==="draggable-question"&&R(x),e.id==="draggable-result"&&D(x)}},[]),T=o.useCallback(()=>{if(l){const e=l.toObject();(async()=>{try{const s=await _(c,e.nodes,e.edges,p,m,f);h.success("Successfully toasted!",{duration:3e3})}catch{h.error("失敗!")}})()}},[l,p,m,f]),d=o.useRef(!0),q=o.useCallback((e,s)=>{d.current=!0,a(n=>v(e,s,n))},[]),A=o.useCallback(()=>{d.current=!1},[]),O=o.useCallback((e,s)=>{d.current||a(n=>n.filter(r=>r.id!==s.id)),d.current=!0},[]);return t.jsxs("div",{className:"flex h-full",children:[t.jsxs(X,{onDragEnd:F,children:[t.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[t.jsx(b,{id:"draggable-question",label:"質問追加"}),t.jsx(b,{id:"draggable-result",label:"結果追加"}),t.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:T,children:"保存"}),t.jsx("div",{className:"text-white",children:"カスタムフローです"})]}),t.jsx(Y,{id:"droppableA",children:t.jsxs(z,{nodes:w,edges:C,nodeTypes:k,edgeTypes:{smoothstep:J},onEdgesChange:E,onNodesChange:j,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:q,onReconnectStart:A,onReconnectEnd:O,onConnect:I,onInit:y,children:[t.jsx(K,{color:"#222",variant:W.Lines,gap:20}),t.jsx(Z,{})]})})]}),t.jsx(ee,{position:"bottom-right",reverseOrder:!1})]})},be=o.memo(se);export{be as default};
