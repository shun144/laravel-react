import{r as n,q as P,y as Q,j as a}from"./app-D37GFJK7.js";import{g as l}from"./utils-DPyr1Ivf.js";import{u as c}from"./store-BgV8G_Jj.js";import B from"./CityHeavenQuestionNode-D6Omfzwa.js";import U from"./CityHeavenResultNode-_F0GAWYS.js";import{D as V}from"./core.esm-C-cttlut.js";import f from"./Draggable-bP3XBXZI.js";import W from"./Droppable-C80YQhjw.js";import{u as X,b as Y,c as G,r as _,d as $,i as z,C as J,S as K,e as Z,f as ee,h as te}from"./index-DtiTTmZW.js";/* empty css             *//* empty css                           */import"./react-BV781huI.js";import"./ChoiceSourceHandle-CmG089Jl.js";import"./index-7Yk29fhJ.js";import"./iconBase-BFWDsY2u.js";import"./index-BB_Gr4fQ.js";import"./SalesPointSelect-D1dNM0nY.js";import"./QuestionSubMenu-BMmtP2kd.js";import"./index-vzC17Uek.js";import"./ResultSubMenu-BxuRGLv3.js";const oe=({initialNodes:C,initialEdges:b,defaultViewport:h})=>{const[y,u]=n.useState(C),[x,r]=n.useState(b),i=n.useRef(!0),p=c(e=>e.isDirty),d=c(e=>e.setIsDirty),N=c(e=>e.setFirstNodeId),{screenToFlowPosition:k,addNodes:m,setViewport:ne,getNodes:E}=X(),{url:w}=P(),S=n.useMemo(()=>({qNode:B,rNode:U}),[]);n.useEffect(()=>{const e=Q.on("before",t=>{const o=t.detail.visit;return o.url.pathname===w&&o.method==="post"?!0:p?confirm("変更が保存されていませんがページを離れてもよろしいですか？"):!0});return()=>{e()}},[p]);const j=n.useCallback(e=>{u(t=>Y(e,t)),d(!0)},[u,d]),D=n.useCallback(e=>{r(t=>G(e,t)),d(!0)},[r,d]),R=e=>{const t=l(),o=l();E().length===0&&N(t),m({id:t,data:{topic:"",choices:[{id:o,content:"",salePoints:[]}]},position:e,type:"qNode",dragHandle:".dhandle"})},v=e=>{const t=l();m({id:t,data:{result:""},position:e,type:"rNode",dragHandle:".dhandle"})},F=n.useCallback(({active:e,over:t,delta:o,activatorEvent:s})=>{if(!(t==null||t.id!="droppableArea")&&s instanceof MouseEvent){const L=s.pageX+o.x,O=s.pageY+o.y,g=k({x:L,y:O});e.id==="draggable-question"&&R(g),e.id==="draggable-result"&&v(g)}},[]),H=n.useCallback((e,t)=>{i.current=!0,r(o=>_(e,t,o))},[]),I=n.useCallback(()=>{i.current=!1},[]),M=n.useCallback(e=>{i.current||r(t=>t.filter(o=>o.id!==e.id)),i.current=!0},[]),q=n.useCallback(e=>{r(t=>$({...e,type:"smoothstep"},t))},[r]),T=n.useCallback((e,t)=>{r(o=>o.map(s=>s.id===t.id?{...s,animated:!s.animated,style:s.animated?{stroke:"gray",strokeWidth:2}:{stroke:"gold",strokeWidth:3}}:{...s,animated:!1,style:{}}))},[r]),A=n.useCallback((e,t)=>{e.preventDefault(),r(o=>o.filter(s=>s.id!==t.id))},[r]);return a.jsx("div",{className:"grow w-full flex",children:a.jsxs(V,{onDragEnd:F,children:[a.jsxs("div",{className:"h-full w-[5%] flex items-center flex-col gap-y-6 pt-12 bg-slate-800",children:[a.jsx(f,{id:"draggable-question",label:"質問",btnColor:"indigo"}),a.jsx(f,{id:"draggable-result",label:"結果",btnColor:"orange"})]}),a.jsx(W,{id:"droppableArea",children:a.jsxs(z,{nodes:y,edges:x,nodeTypes:S,onNodesChange:j,onEdgesChange:D,snapToGrid:!0,connectionLineType:J.SmoothStep,onReconnect:H,onReconnectStart:I,onReconnectEnd:(e,t)=>M(t),onConnect:q,onEdgeClick:T,onEdgeContextMenu:A,elevateEdgesOnSelect:!0,defaultViewport:h,panOnScroll:!0,elementsSelectable:!0,selectionMode:K.Partial,children:[a.jsx(Z,{color:"#222",variant:ee.Lines,gap:20}),a.jsx(te,{})]})})]})})},we=n.memo(oe);export{we as default};
