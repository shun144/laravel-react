import{r as o,j as s}from"./app-CLtd0l1O.js";import{c as X,g as u}from"./utils-DnMOXxyc.js";import{u as i}from"./store-Bh6xa2Wy.js";import Y from"./CityHeavenQuestionNode-Goe9OKTt.js";import G from"./CityHeavenResultNode-D4YQBb8P.js";import{D as P}from"./core.esm-Chk-jPgP.js";import x from"./Draggable-Dl99XLQ4.js";import $ from"./Droppable-or9Q86UY.js";import{u as z,a as J,b as K,c as W,d as Z,r as ee,e as te,i as oe,S as se,C as ne,B as ae,f as de,g as ce}from"./index-CsmzVUu1.js";import{_ as N,I as ie}from"./index-CJUi75YX.js";import{i as re,p as y}from"./index-CJy3gCXu.js";/* empty css                           */import"./react-CHX_hP92.js";import"./ChoiceSourceHandle-DZ3aU89a.js";import"./index-DfVLiIJs.js";import"./iconBase-B1NUaL_I.js";import"./salesPoints-Y2rWhV46.js";const le="cityheaven-qestion-menu-id",ue=({flowId:w})=>{const[j,p]=o.useState(z()),[E,a]=o.useState(J()),[r,k]=o.useState(),g=i(e=>e.setFirstNodeId),m=i(e=>e.firstNodeId),f=i(e=>e.flowTitle),h=i(e=>e.flowUrl),c=o.useRef(!0),{screenToFlowPosition:R,addNodes:C,setViewport:pe,getNodes:d,deleteElements:S}=K(),I=o.useMemo(()=>({cityHeavenQuestionNode:Y,cityHeavenResultNode:G}),[]),H=o.useMemo(()=>({type:"smoothstep"}),[]),v=o.useCallback(e=>{p(t=>W(e,t))},[p]),T=o.useCallback(e=>a(t=>Z(e,t)),[a]),F=e=>{const t=u(),n=u();d().length===0&&g(t),C({id:t,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"cityHeavenQuestionNode",dragHandle:".custom-drag-handle"})},D=e=>{const t=u();C({id:t,data:{result:""},position:e,type:"cityHeavenResultNode",dragHandle:".custom-drag-handle"})},Q=o.useCallback(({active:e,over:t,delta:n,activatorEvent:l})=>{if(!(t==null||t.id!="droppableA")&&l instanceof MouseEvent){const B=l.pageX+n.x,L=l.pageY+n.y,b=R({x:B,y:L});e.id==="draggable-question"&&F(b),e.id==="draggable-result"&&D(b)}},[]),O=o.useCallback(()=>{if(r){const e=r.toObject();(async()=>{try{const t=await X(w,e.nodes,e.edges,m,f,h);N.success("Successfully toasted!",{duration:3e3})}catch{N.error("失敗!")}})()}},[r,m,f,h]),U=o.useCallback((e,t)=>{c.current=!0,a(n=>ee(e,t,n))},[]),_=o.useCallback(()=>{c.current=!1},[]),q=o.useCallback(e=>{c.current||a(t=>t.filter(n=>n.id!==e.id)),c.current=!0},[]),A=o.useCallback(e=>{a(t=>te(e,t))},[a]),M=o.useCallback(()=>{const e=d().filter(t=>t.selected===!0);S({nodes:[{id:e[0].id}]})},[d]),V=o.useCallback(()=>{const e=d().filter(t=>t.selected===!0);g(e[0].id)},[d]);return s.jsxs("div",{className:"h-full flex",children:[s.jsxs(P,{onDragEnd:Q,children:[s.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 py-3 bg-slate-800",children:[s.jsx(x,{id:"draggable-question",label:"質問"}),s.jsx(x,{id:"draggable-result",label:"アンケート終了"}),s.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:O,children:"保存"})]}),s.jsx($,{id:"droppableA",children:s.jsxs(oe,{nodes:j,edges:E,nodeTypes:I,onEdgesChange:e=>T(e),onNodesChange:e=>v(e),fitView:!0,fitViewOptions:{padding:.4},snapToGrid:!0,edgeTypes:{smoothstep:se},connectionLineType:ne.SmoothStep,onReconnect:(e,t)=>U(e,t),onReconnectStart:()=>_(),onReconnectEnd:(e,t)=>q(t),onConnect:e=>A(e),onInit:k,defaultEdgeOptions:H,children:[s.jsx(ae,{color:"#222",variant:de.Lines,gap:20}),s.jsx(ce,{})]})})]}),s.jsx(ie,{position:"bottom-right",reverseOrder:!1}),s.jsxs(re,{id:le,children:[s.jsx(y,{onClick:()=>V(),children:"1問目に設定"}),s.jsx(y,{onClick:()=>M(),children:"削除"})]})]})},ve=o.memo(ue);export{ve as default};
