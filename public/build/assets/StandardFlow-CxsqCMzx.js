import{r as o,j as s}from"./app-BSo6kXZY.js";import{g as Q,a as B,b as c}from"./utils-Cv_Fd-UN.js";import{u as i}from"./store-Cp7ap0tw.js";import H from"./QuestionNode-DvP9J2X8.js";import M from"./ResultNode-COmf_iYE.js";import{D as U}from"./core.esm-B1soZA4t.js";import m from"./Draggable-DQnjGjdO.js";import X from"./Droppable-BK58cr0Z.js";import{b as Y,c as G,u as L,d as P,r as _,i as $,S as z,e as J,f as K,C as W}from"./index-w2Xxs-C-.js";/* empty css             */import{I as Z}from"./index-DtgmeOhI.js";import"./react-Bzdh-nCb.js";import"./ChoiceSourceHandle-BxEXwUOL.js";import"./index-BlMAzcRb.js";import"./iconBase-11qJnLgw.js";const v=({flowId:u})=>{const[f,b,x]=Y([]),[N,a,h]=G([]),{screenToFlowPosition:w,addNodes:p,setViewport:ee}=L(),[l,C]=o.useState();i(e=>e.setFirstNodeId);const j=i(e=>e.firstNodeId),E=i(e=>e.flowTitle),I=i(e=>e.flowUrl),S=o.useMemo(()=>({questionNode:H,resultNode:M}),[]);o.useEffect(()=>{(async()=>{const e=await Q(u),t=await B(u);b(e),a(t)})()},[]);const R=o.useCallback(e=>a(t=>P(e,t)),[a]),k=e=>{const t=c(),n=c();p({id:t,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionNode",dragHandle:".custom-drag-handle"})},y=e=>{const t=c();p({id:t,data:{result:""},position:e,type:"resultNode",dragHandle:".custom-drag-handle"})},D=o.useCallback(({active:e,over:t,delta:n,activatorEvent:r})=>{if(!(t==null||t.id!="droppableA")&&r instanceof MouseEvent){const O=r.pageX+n.x,V=r.pageY+n.y,g=w({x:O,y:V});e.id==="draggable-question"&&k(g),e.id==="draggable-result"&&y(g)}},[]),T=o.useCallback(()=>{l&&l.toObject()},[l,j,E,I]),d=o.useRef(!0),F=o.useCallback((e,t)=>{d.current=!0,a(n=>_(e,t,n))},[]),q=o.useCallback(()=>{d.current=!1},[]),A=o.useCallback((e,t)=>{d.current||a(n=>n.filter(r=>r.id!==t.id)),d.current=!0},[]);return s.jsxs("div",{className:"flex h-full",children:[s.jsxs(U,{onDragEnd:D,children:[s.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[s.jsx(m,{id:"draggable-question",label:"質問追加"}),s.jsx(m,{id:"draggable-result",label:"結果追加"}),s.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:T,children:"保存"})]}),s.jsx(X,{id:"droppableA",children:s.jsxs($,{nodes:f,edges:N,nodeTypes:S,edgeTypes:{smoothstep:z},onEdgesChange:h,onNodesChange:x,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:F,onReconnectStart:q,onReconnectEnd:A,onConnect:R,onInit:C,children:[s.jsx(J,{color:"#222",variant:K.Lines,gap:20}),s.jsx(W,{})]})})]}),s.jsx(Z,{position:"bottom-right",reverseOrder:!1})]})},be=o.memo(v);export{be as default};
