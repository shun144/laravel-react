import{r as o,j as s}from"./app-DqVqaljI.js";import{c as B,d as P,e as U,f as _,h as u}from"./utils-Ca-100RQ.js";import{u as c}from"./store-iJRsnbLv.js";import M from"./CityHeavenQuestionNode-BzoIQYqn.js";import X from"./CityHeavenResultNode-BncRzumT.js";import{D as Y}from"./core.esm-C8IuNHfz.js";import{Draggable as b}from"./Draggable-Bql1MpAW.js";import{Droppable as G}from"./Droppable-CYOrid2D.js";import{u as L,a as $,b as z,c as J,r as K,i as W,S as Z,P as ee,B as te,d as se,C as oe}from"./index-CWjlaHVJ.js";import{_ as N,I as ne}from"./index-C3wIZTUl.js";import"./react-9UC6Oz1t.js";import"./ChoiceSourceHandle-CcQkwivX.js";import"./index-BqSdfmDN.js";import"./iconBase-Cbg9ZGOh.js";import"./DraggableBlockSource-XSRU4xum.js";const ae=({flowId:r})=>{const[w,y,C]=L([]),[j,a,E]=$([]),{screenToFlowPosition:I,addNodes:g,setViewport:ie,getNodes:R}=z(),[l,H]=o.useState(),p=c(e=>e.setFirstNodeId),m=c(e=>e.firstNodeId),f=c(e=>e.flowTitle),x=c(e=>e.flowUrl),v=o.useMemo(()=>({cityHeavenQuestionNode:M,cityHeavenResultNode:X}),[]);o.useEffect(()=>{(async()=>{const e=await B(r),t=await P(r),n=await U(r);y(e),a(t),p(n)})()},[]);const S=o.useCallback(e=>a(t=>J(e,t)),[a]),k=e=>{const t=u(),n=u();R().length===0&&p(t),g({id:t,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"cityHeavenQuestionNode",dragHandle:".custom-drag-handle"})},F=e=>{const t=u();g({id:t,data:{result:""},position:e,type:"cityHeavenResultNode",dragHandle:".custom-drag-handle"})},Q=o.useCallback(({active:e,over:t,delta:n,activatorEvent:i})=>{if(!(t==null||t.id!="droppableA")&&i instanceof MouseEvent){const V=i.pageX+n.x,q=i.pageY+n.y,h=I({x:V,y:q});e.id==="draggable-question"&&k(h),e.id==="draggable-result"&&F(h)}},[]),D=o.useCallback(()=>{if(l){const e=l.toObject();(async()=>{try{const t=await _(r,e.nodes,e.edges,m,f,x);N.success("Successfully toasted!",{duration:3e3})}catch{N.error("失敗!")}})()}},[l,m,f,x]),d=o.useRef(!0),T=o.useCallback((e,t)=>{d.current=!0,a(n=>K(e,t,n))},[]),A=o.useCallback(()=>{d.current=!1},[]),O=o.useCallback((e,t)=>{d.current||a(n=>n.filter(i=>i.id!==t.id)),d.current=!0},[]);return s.jsxs("div",{className:"flex h-full",children:[s.jsxs(Y,{onDragEnd:Q,children:[s.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[s.jsx(b,{id:"draggable-question",label:"質問(チェック付き)追加"}),s.jsx(b,{id:"draggable-result",label:"推奨追加"}),s.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:D,children:"保存"}),s.jsx("div",{className:"text-blue-200",children:"チェックフローです"})]}),s.jsx(G,{id:"droppableA",children:s.jsxs(W,{nodes:w,edges:j,nodeTypes:v,edgeTypes:{smoothstep:Z},onEdgesChange:E,onNodesChange:C,fitView:!0,fitViewOptions:{padding:.4},snapToGrid:!0,onReconnect:T,onReconnectStart:A,onReconnectEnd:O,onConnect:S,onInit:H,children:[s.jsx(ee,{position:"top-right",children:s.jsx("div",{className:"w-10 h-10 bg-slate-50",children:"test"})}),s.jsx(te,{color:"#222",variant:se.Lines,gap:20}),s.jsx(oe,{})]})})]}),s.jsx(ne,{position:"bottom-right",reverseOrder:!1})]})},Ce=o.memo(ae);export{Ce as default};
