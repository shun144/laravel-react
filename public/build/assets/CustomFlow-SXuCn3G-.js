import{r as o,j as t}from"./app-Djr3pS6i.js";import{b as A,c as T,h as V,f as l}from"./utils-D-QC8cQz.js";import B from"./QuestionNode-Bim2RMC8.js";import P from"./ResultNode-Bou05gfv.js";import{D as Q}from"./core.esm-BfgOf-z1.js";import{Draggable as g}from"./Draggable-BYtgIxNz.js";import{Droppable as H}from"./Droppable-BSDkjo0I.js";import{u as M,a as O,b as X,c as Y,r as G,i as L,S as U,P as _,B as $,d as v,C as z}from"./index-FTrqLg0J.js";/* empty css             */import"./ChoiceSourceHandle-CeZD5PdG.js";import"./index-DTFTZLlI.js";import"./iconBase-DKpWyc9o.js";import"./DraggableBlockSource-BgPDNHMd.js";const J=({flowId:r})=>{const[m,f,x]=M([]),[b,a,h]=O([]),{screenToFlowPosition:N,addNodes:u,setViewport:K}=X(),[c,C]=o.useState(),w=o.useMemo(()=>({questionNode:B,resultNode:P}),[]);o.useEffect(()=>{(async()=>{const e=await A(r),s=await T(r);f(e),a(s)})()},[]);const j=o.useCallback(e=>a(s=>Y(e,s)),[a]),E=e=>{const s=l(),n=l();u({id:s,data:{topic:"",choices:[{id:n,content:""}]},position:e,type:"questionNode",dragHandle:".custom-drag-handle"})},R=e=>{const s=l();u({id:s,data:{result:""},position:e,type:"resultNode",dragHandle:".custom-drag-handle"})},k=o.useCallback(({active:e,over:s,delta:n,activatorEvent:i})=>{if(!(s==null||s.id!="droppableA")&&i instanceof MouseEvent){const F=i.pageX+n.x,I=i.pageY+n.y,p=N({x:F,y:I});e.id==="draggable-question"&&E(p),e.id==="draggable-result"&&R(p)}},[]),y=o.useCallback(()=>{if(c){const e=c.toObject();V(r,e.nodes,e.edges)}},[c]),d=o.useRef(!0),S=o.useCallback((e,s)=>{d.current=!0,a(n=>G(e,s,n))},[]),D=o.useCallback(()=>{d.current=!1},[]),q=o.useCallback((e,s)=>{d.current||a(n=>n.filter(i=>i.id!==s.id)),d.current=!0},[]);return t.jsx("div",{className:"flex h-full",children:t.jsxs(Q,{onDragEnd:k,children:[t.jsxs("div",{className:"w-[10%] flex items-center flex-col gap-y-3 pt-3 bg-slate-800",children:[t.jsx(g,{id:"draggable-question",label:"質問追加"}),t.jsx(g,{id:"draggable-result",label:"結果追加"}),t.jsx("button",{className:"bg-purple-700 border rounded w-[120px] h-[80px] text-white",onClick:y,children:"保存"}),t.jsx("div",{className:"text-white",children:"カスタムフローです"})]}),t.jsx(H,{id:"droppableA",children:t.jsxs(L,{nodes:m,edges:b,nodeTypes:w,edgeTypes:{smoothstep:U},onEdgesChange:h,onNodesChange:x,fitView:!0,fitViewOptions:{padding:.2},snapToGrid:!0,onReconnect:S,onReconnectStart:D,onReconnectEnd:q,onConnect:j,onInit:C,children:[t.jsx(_,{position:"top-right",children:t.jsx("div",{className:"w-10 h-10 bg-slate-50",children:"test"})}),t.jsx($,{color:"#222",variant:v.Lines,gap:20}),t.jsx(z,{})]})})]})})},ue=o.memo(J);export{ue as default};
